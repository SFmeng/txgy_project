# 防腐保温智慧平台前端开发文档

## 1. 项目概述

### 1.1 技术栈
- **框架**: Vue 3.4+
- **路由**: Vue Router 4.x
- **状态管理**: Pinia 2.x
- **HTTP客户端**: Axios 1.x
- **UI组件库**: Element Plus 2.x
- **CSS框架**: Tailwind CSS 3.x
- **构建工具**: Vite 5.x
- **包管理器**: npm/yarn/pnpm

### 1.2 项目结构
```
txgy_frontend/
├── public/                     # 静态资源
├── src/
│   ├── api/                   # API接口封装
│   ├── assets/                # 静态资源（图片、字体等）
│   ├── components/            # 公共组件
│   ├── composables/           # 组合式函数
│   ├── layouts/               # 布局组件
│   ├── pages/                 # 页面组件
│   ├── router/                # 路由配置
│   ├── stores/                # Pinia状态管理
│   ├── styles/                # 样式文件
│   ├── utils/                 # 工具函数
│   ├── App.vue               # 根组件
│   └── main.js               # 入口文件
├── package.json
├── vite.config.js
├── tailwind.config.js
└── README.md
```

## 2. 开发环境配置

### 2.1 环境要求
- Node.js 18.0+
- npm 9.0+ / yarn 1.22+ / pnpm 8.0+

### 2.2 项目初始化
```bash
# 创建项目
npm create vue@latest txgy_frontend

# 进入项目目录
cd txgy_frontend

# 安装依赖
npm install

# 安装额外依赖
npm install element-plus @element-plus/icons-vue
npm install tailwindcss @tailwindcss/forms @tailwindcss/typography
npm install axios pinia
npm install @vueuse/core dayjs lodash-es
```

### 2.3 配置文件

#### vite.config.js
```javascript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { resolve } from 'path'

export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
      '@api': resolve(__dirname, 'src/api'),
      '@components': resolve(__dirname, 'src/components'),
      '@utils': resolve(__dirname, 'src/utils'),
      '@stores': resolve(__dirname, 'src/stores')
    }
  },
  server: {
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:8000',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '/api')
      }
    }
  },
  build: {
    outDir: 'dist',
    sourcemap: false,
    rollupOptions: {
      output: {
        chunkFileNames: 'js/[name]-[hash].js',
        entryFileNames: 'js/[name]-[hash].js',
        assetFileNames: '[ext]/[name]-[hash].[ext]'
      }
    }
  }
})
```

#### tailwind.config.js
```javascript
module.exports = {
  content: [
    "./index.html",
    "./src/**/*.{vue,js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {
      colors: {
        primary: {
          50: '#eff6ff',
          500: '#3b82f6',
          600: '#2563eb',
          700: '#1d4ed8'
        },
        success: '#67c23a',
        warning: '#e6a23c',
        danger: '#f56c6c',
        info: '#909399'
      },
      spacing: {
        '18': '4.5rem',
        '88': '22rem'
      }
    },
  },
  plugins: [
    require('@tailwindcss/forms'),
    require('@tailwindcss/typography')
  ],
}
```

## 3. 核心功能模块开发

### 3.1 用户认证模块

#### 3.1.1 登录页面 (pages/auth/Login.vue)
```vue
<template>
  <div class="min-h-screen flex items-center justify-center bg-gray-50">
    <div class="max-w-md w-full space-y-8">
      <div class="text-center">
        <h2 class="text-3xl font-bold text-gray-900">天信系统登录</h2>
        <p class="mt-2 text-sm text-gray-600">防腐保温行业信息交互平台</p>
      </div>
      
      <el-form 
        ref="loginFormRef" 
        :model="loginForm" 
        :rules="loginRules"
        class="space-y-6"
      >
        <el-form-item prop="username">
          <el-input
            v-model="loginForm.username"
            placeholder="用户名/手机号"
            size="large"
            prefix-icon="User"
          />
        </el-form-item>
        
        <el-form-item prop="password">
          <el-input
            v-model="loginForm.password"
            type="password"
            placeholder="密码"
            size="large"
            prefix-icon="Lock"
            show-password
          />
        </el-form-item>
        
        <el-form-item>
          <el-button 
            type="primary" 
            size="large" 
            class="w-full"
            :loading="loading"
            @click="handleLogin"
          >
            登录
          </el-button>
        </el-form-item>
      </el-form>
      
      <div class="text-center">
        <router-link to="/auth/register" class="text-primary-600 hover:text-primary-500">
          还没有账号？立即注册
        </router-link>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, reactive } from 'vue'
import { useRouter } from 'vue-router'
import { useAuthStore } from '@/stores/auth'
import { ElMessage } from 'element-plus'

const router = useRouter()
const authStore = useAuthStore()

const loginFormRef = ref()
const loading = ref(false)

const loginForm = reactive({
  username: '',
  password: '',
  login_type: 'password'
})

const loginRules = {
  username: [
    { required: true, message: '请输入用户名或手机号', trigger: 'blur' }
  ],
  password: [
    { required: true, message: '请输入密码', trigger: 'blur' },
    { min: 6, message: '密码长度不能少于6位', trigger: 'blur' }
  ]
}

const handleLogin = async () => {
  try {
    await loginFormRef.value.validate()
    loading.value = true
    
    await authStore.login(loginForm)
    ElMessage.success('登录成功')
    
    // 根据用户类型跳转到不同页面
    const userType = authStore.userInfo.user_type
    if (userType === 'enterprise') {
      router.push('/dashboard/enterprise')
    } else {
      router.push('/dashboard/individual')
    }
  } catch (error) {
    ElMessage.error(error.message || '登录失败')
  } finally {
    loading.value = false
  }
}
</script>
```

#### 3.1.2 认证状态管理 (stores/auth.js)
```javascript
import { defineStore } from 'pinia'
import { ref, computed } from 'vue'
import { authAPI } from '@/api/auth'
import { setToken, removeToken, getToken } from '@/utils/auth'

export const useAuthStore = defineStore('auth', () => {
  const token = ref(getToken())
  const userInfo = ref(null)
  const permissions = ref([])

  const isLoggedIn = computed(() => !!token.value)
  const isEnterprise = computed(() => userInfo.value?.user_type === 'enterprise')
  const isIndividual = computed(() => userInfo.value?.user_type === 'individual')

  // 登录
  const login = async (loginData) => {
    try {
      const response = await authAPI.login(loginData)
      const { access_token, user_info } = response.data
      
      token.value = access_token
      userInfo.value = user_info
      permissions.value = user_info.permissions || []
      
      setToken(access_token)
      return response
    } catch (error) {
      throw error
    }
  }

  // 登出
  const logout = () => {
    token.value = null
    userInfo.value = null
    permissions.value = []
    removeToken()
  }

  // 获取用户信息
  const fetchUserInfo = async () => {
    try {
      const response = await authAPI.getProfile()
      userInfo.value = response.data
      permissions.value = response.data.permissions || []
      return response
    } catch (error) {
      logout()
      throw error
    }
  }

  // 检查权限
  const hasPermission = (permission) => {
    return permissions.value.includes(permission)
  }

  return {
    token,
    userInfo,
    permissions,
    isLoggedIn,
    isEnterprise,
    isIndividual,
    login,
    logout,
    fetchUserInfo,
    hasPermission
  }
})
```

### 3.2 产品信息模块

#### 3.2.1 产品列表页面 (pages/products/ProductList.vue)
```vue
<template>
  <div class="p-6">
    <!-- 搜索筛选区域 -->
    <div class="bg-white p-4 rounded-lg shadow mb-6">
      <el-form :model="searchForm" inline class="search-form">
        <el-form-item label="关键词">
          <el-input
            v-model="searchForm.keyword"
            placeholder="请输入产品名称或关键词"
            clearable
            @keyup.enter="handleSearch"
          />
        </el-form-item>
        
        <el-form-item label="产品类型">
          <el-cascader
            v-model="searchForm.product_type"
            :options="productTypeOptions"
            placeholder="请选择产品类型"
            clearable
          />
        </el-form-item>
        
        <el-form-item label="地区">
          <el-cascader
            v-model="searchForm.region"
            :options="regionOptions"
            placeholder="请选择地区"
            clearable
          />
        </el-form-item>
        
        <el-form-item label="价格范围">
          <el-input-number
            v-model="searchForm.price_range.min_price"
            placeholder="最低价"
            :min="0"
            controls-position="right"
          />
          <span class="mx-2">-</span>
          <el-input-number
            v-model="searchForm.price_range.max_price"
            placeholder="最高价"
            :min="0"
            controls-position="right"
          />
        </el-form-item>
        
        <el-form-item>
          <el-button type="primary" @click="handleSearch">搜索</el-button>
          <el-button @click="handleReset">重置</el-button>
        </el-form-item>
      </el-form>
    </div>

    <!-- 产品列表 -->
    <div class="bg-white rounded-lg shadow">
      <div class="p-4 border-b flex justify-between items-center">
        <h3 class="text-lg font-semibold">产品列表</h3>
        <div class="flex items-center space-x-4">
          <el-select v-model="sortBy" placeholder="排序方式" @change="handleSearch">
            <el-option label="相关度" value="relevance" />
            <el-option label="价格从低到高" value="price_asc" />
            <el-option label="价格从高到低" value="price_desc" />
            <el-option label="评级" value="rating" />
          </el-select>
          
          <el-button-group>
            <el-button :type="viewMode === 'grid' ? 'primary' : ''" @click="viewMode = 'grid'">
              <el-icon><Grid /></el-icon>
            </el-button>
            <el-button :type="viewMode === 'list' ? 'primary' : ''" @click="viewMode = 'list'">
              <el-icon><List /></el-icon>
            </el-button>
          </el-button-group>
        </div>
      </div>
      
      <!-- 网格视图 -->
      <div v-if="viewMode === 'grid'" class="p-4">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
          <ProductCard
            v-for="product in productList"
            :key="product.id"
            :product="product"
            @view-detail="handleViewDetail"
            @add-to-favorites="handleAddToFavorites"
            @send-inquiry="handleSendInquiry"
          />
        </div>
      </div>
      
      <!-- 列表视图 -->
      <div v-else class="p-4">
        <el-table :data="productList" stripe>
          <el-table-column prop="name" label="产品名称" min-width="200">
            <template #default="{ row }">
              <div class="flex items-center">
                <img :src="row.thumbnail" class="w-12 h-12 rounded mr-3" />
                <div>
                  <div class="font-medium">{{ row.name }}</div>
                  <div class="text-sm text-gray-500">{{ row.supplier_name }}</div>
                </div>
              </div>
            </template>
          </el-table-column>
          
          <el-table-column prop="price" label="价格" width="120">
            <template #default="{ row }">
              <span class="text-red-600 font-bold">¥{{ row.price }}</span>
              <div class="text-xs text-gray-500">{{ row.unit }}</div>
            </template>
          </el-table-column>
          
          <el-table-column prop="supplier_rating" label="供应商评级" width="120">
            <template #default="{ row }">
              <el-rate :value="getStarRating(row.supplier_rating)" disabled />
            </template>
          </el-table-column>
          
          <el-table-column prop="inventory_quantity" label="库存" width="100" />
          <el-table-column prop="delivery_period" label="供货周期" width="100" />
          <el-table-column prop="location" label="地区" width="120" />
          
          <el-table-column label="操作" width="200" fixed="right">
            <template #default="{ row }">
              <el-button size="small" @click="handleViewDetail(row.id)">详情</el-button>
              <el-button size="small" type="primary" @click="handleSendInquiry(row)">询价</el-button>
              <el-button size="small" @click="handleAddToFavorites(row.id)">收藏</el-button>
            </template>
          </el-table-column>
        </el-table>
      </div>
      
      <!-- 分页 -->
      <div class="p-4 border-t">
        <el-pagination
          v-model:current-page="pagination.page"
          v-model:page-size="pagination.page_size"
          :page-sizes="[10, 20, 50, 100]"
          :total="pagination.total"
          layout="total, sizes, prev, pager, next, jumper"
          @size-change="handleSearch"
          @current-change="handleSearch"
        />
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, reactive, onMounted } from 'vue'
import { useRouter } from 'vue-router'
import { ElMessage } from 'element-plus'
import { Grid, List } from '@element-plus/icons-vue'
import ProductCard from '@/components/ProductCard.vue'
import { searchAPI } from '@/api/search'
import { useDictionaryStore } from '@/stores/dictionary'

const router = useRouter()
const dictionaryStore = useDictionaryStore()

const viewMode = ref('grid')
const sortBy = ref('relevance')
const loading = ref(false)
const productList = ref([])

const searchForm = reactive({
  keyword: '',
  product_type: [],
  region: [],
  price_range: {
    min_price: null,
    max_price: null
  },
  supplier_rating: '',
  inventory_status: ''
})

const pagination = reactive({
  page: 1,
  page_size: 20,
  total: 0
})

const productTypeOptions = ref([])
const regionOptions = ref([])

// 获取字典数据
const fetchDictionaries = async () => {
  try {
    const [productTypes, regions] = await Promise.all([
      dictionaryStore.getProductCategories(),
      dictionaryStore.getRegions()
    ])
    productTypeOptions.value = productTypes
    regionOptions.value = regions
  } catch (error) {
    ElMessage.error('获取字典数据失败')
  }
}

// 搜索产品
const handleSearch = async () => {
  try {
    loading.value = true
    const params = {
      ...searchForm,
      sort_by: sortBy.value,
      page: pagination.page,
      page_size: pagination.page_size
    }
    
    const response = await searchAPI.multiDimensionSearch(params)
    productList.value = response.data.results
    pagination.total = response.data.pagination.total
  } catch (error) {
    ElMessage.error('搜索失败')
  } finally {
    loading.value = false
  }
}

// 重置搜索
const handleReset = () => {
  Object.assign(searchForm, {
    keyword: '',
    product_type: [],
    region: [],
    price_range: { min_price: null, max_price: null },
    supplier_rating: '',
    inventory_status: ''
  })
  pagination.page = 1
  handleSearch()
}

// 查看详情
const handleViewDetail = (productId) => {
  router.push(`/products/${productId}`)
}

// 添加收藏
const handleAddToFavorites = async (productId) => {
  try {
    // 调用收藏API
    ElMessage.success('收藏成功')
  } catch (error) {
    ElMessage.error('收藏失败')
  }
}

// 发起询价
const handleSendInquiry = (product) => {
  router.push({
    path: '/inquiry/create',
    query: { productId: product.id }
  })
}

// 获取星级评分数值
const getStarRating = (rating) => {
  const ratingMap = {
    '1star': 1, '2star': 2, '3star': 3, '4star': 4, '5star': 5
  }
  return ratingMap[rating] || 0
}

onMounted(() => {
  fetchDictionaries()
  handleSearch()
})
</script>
```

### 3.3 API接口封装

#### 3.3.1 HTTP请求配置 (utils/request.js)
```javascript
import axios from 'axios'
import { ElMessage, ElMessageBox } from 'element-plus'
import { useAuthStore } from '@/stores/auth'
import router from '@/router'

// 创建axios实例
const request = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || '/api',
  timeout: 10000,
  headers: {
    'Content-Type': 'application/json'
  }
})

// 请求拦截器
request.interceptors.request.use(
  (config) => {
    const authStore = useAuthStore()
    if (authStore.token) {
      config.headers.Authorization = `Bearer ${authStore.token}`
    }
    return config
  },
  (error) => {
    return Promise.reject(error)
  }
)

// 响应拦截器
request.interceptors.response.use(
  (response) => {
    const { code, message, data } = response.data
    
    if (code === 200) {
      return { data, message }
    } else {
      ElMessage.error(message || '请求失败')
      return Promise.reject(new Error(message))
    }
  },
  (error) => {
    const { response } = error
    
    if (response) {
      const { status, data } = response
      
      switch (status) {
        case 401:
          ElMessageBox.confirm('登录已过期，请重新登录', '提示', {
            confirmButtonText: '重新登录',
            cancelButtonText: '取消',
            type: 'warning'
          }).then(() => {
            const authStore = useAuthStore()
            authStore.logout()
            router.push('/auth/login')
          })
          break
        case 403:
          ElMessage.error('权限不足')
          break
        case 404:
          ElMessage.error('请求的资源不存在')
          break
        case 422:
          ElMessage.error(data.message || '数据验证失败')
          break
        case 500:
          ElMessage.error('服务器内部错误')
          break
        default:
          ElMessage.error(data.message || '请求失败')
      }
    } else {
      ElMessage.error('网络连接失败')
    }
    
    return Promise.reject(error)
  }
)

export default request
```
