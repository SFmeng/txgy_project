# 防腐保温智慧平台测试计划文档

## 1. 测试概述

### 1.1 测试目标
- 验证系统功能的正确性和完整性
- 确保系统性能满足需求指标
- 验证系统安全性和稳定性
- 确保用户体验符合设计要求

### 1.2 测试范围
- **功能测试**: 所有业务功能模块
- **接口测试**: 所有API接口
- **性能测试**: 关键业务场景
- **安全测试**: 认证、权限、数据安全
- **兼容性测试**: 多浏览器、多设备
- **用户体验测试**: 界面交互、流程体验

### 1.3 测试环境
- **开发环境**: 开发人员本地测试
- **测试环境**: QA团队功能测试
- **预生产环境**: 性能测试和集成测试
- **生产环境**: 生产发布后验证

## 2. 功能测试计划

### 2.1 用户认证模块测试

#### 2.1.1 用户注册测试用例
| 用例ID | 测试场景 | 输入数据 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| TC_AUTH_001 | 企业用户正常注册 | 完整有效的企业信息 | 注册成功，状态为待审核 | 高 |
| TC_AUTH_002 | 个人用户正常注册 | 完整有效的个人信息 | 注册成功，状态为待审核 | 高 |
| TC_AUTH_003 | 重复用户名注册 | 已存在的用户名 | 提示用户名已存在 | 中 |
| TC_AUTH_004 | 无效手机号注册 | 格式错误的手机号 | 提示手机号格式错误 | 中 |
| TC_AUTH_005 | 验证码错误 | 错误的短信验证码 | 提示验证码错误 | 中 |
| TC_AUTH_006 | 密码强度不足 | 弱密码 | 提示密码强度不足 | 低 |

#### 2.1.2 用户登录测试用例
| 用例ID | 测试场景 | 输入数据 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| TC_LOGIN_001 | 用户名密码登录 | 正确的用户名和密码 | 登录成功，返回Token | 高 |
| TC_LOGIN_002 | 手机号密码登录 | 正确的手机号和密码 | 登录成功，返回Token | 高 |
| TC_LOGIN_003 | 错误密码登录 | 错误的密码 | 提示用户名或密码错误 | 高 |
| TC_LOGIN_004 | 未激活用户登录 | 未激活用户凭据 | 提示账号待审核 | 中 |
| TC_LOGIN_005 | 被封禁用户登录 | 被封禁用户凭据 | 提示账号已被封禁 | 中 |

### 2.2 信息发布模块测试

#### 2.2.1 供应信息发布测试用例
| 用例ID | 测试场景 | 输入数据 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| TC_SUPPLY_001 | 供应商发布产品信息 | 完整的产品信息 | 发布成功，进入审核流程 | 高 |
| TC_SUPPLY_002 | 必填字段缺失 | 缺少产品名称 | 提示必填字段不能为空 | 高 |
| TC_SUPPLY_003 | 图片格式错误 | 上传非支持格式图片 | 提示图片格式不支持 | 中 |
| TC_SUPPLY_004 | 价格超出范围 | 负数价格 | 提示价格必须大于0 | 中 |
| TC_SUPPLY_005 | 库存数量异常 | 负数库存 | 提示库存数量不能为负 | 低 |

#### 2.2.2 采购需求发布测试用例
| 用例ID | 测试场景 | 输入数据 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| TC_DEMAND_001 | 企业发布采购需求 | 完整的采购需求信息 | 发布成功，自动匹配供应商 | 高 |
| TC_DEMAND_002 | 预算金额异常 | 超大金额预算 | 提示预算金额超出合理范围 | 中 |
| TC_DEMAND_003 | 交货周期异常 | 0天交货周期 | 提示交货周期至少1天 | 中 |

### 2.3 搜索匹配模块测试

#### 2.3.1 多维度搜索测试用例
| 用例ID | 测试场景 | 输入数据 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| TC_SEARCH_001 | 关键词搜索 | "防腐涂料" | 返回相关产品列表 | 高 |
| TC_SEARCH_002 | 地区筛选 | 北京市 | 返回北京地区供应商 | 高 |
| TC_SEARCH_003 | 价格区间筛选 | 5000-8000元 | 返回价格在范围内的产品 | 高 |
| TC_SEARCH_004 | 组合条件搜索 | 关键词+地区+价格 | 返回满足所有条件的结果 | 高 |
| TC_SEARCH_005 | 空搜索结果 | 不存在的产品名称 | 提示无搜索结果 | 中 |

#### 2.3.2 智能推荐测试用例
| 用例ID | 测试场景 | 输入数据 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| TC_RECOMMEND_001 | 基于搜索历史推荐 | 用户搜索历史 | 推荐相关产品/供应商 | 高 |
| TC_RECOMMEND_002 | 基于收藏推荐 | 用户收藏记录 | 推荐相似产品 | 中 |
| TC_RECOMMEND_003 | 新用户推荐 | 无历史行为的新用户 | 推荐热门产品 | 中 |

### 2.4 沟通互动模块测试

#### 2.4.1 即时通讯测试用例
| 用例ID | 测试场景 | 输入数据 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| TC_CHAT_001 | 发送文本消息 | 普通文本内容 | 消息发送成功，对方收到 | 高 |
| TC_CHAT_002 | 发送文件消息 | PDF文件 | 文件上传成功，对方可下载 | 高 |
| TC_CHAT_003 | 消息撤回 | 2分钟内的消息 | 撤回成功，显示已撤回 | 中 |
| TC_CHAT_004 | 离线消息 | 对方离线时发送 | 对方上线后收到消息 | 中 |
| TC_CHAT_005 | 敏感词过滤 | 包含敏感词的消息 | 消息被过滤或提示 | 低 |

#### 2.4.2 报价议价测试用例
| 用例ID | 测试场景 | 输入数据 | 预期结果 | 优先级 |
|--------|----------|----------|----------|--------|
| TC_QUOTE_001 | 供应商提交报价 | 完整报价信息 | 报价提交成功，买方收到通知 | 高 |
| TC_QUOTE_002 | 买方议价 | 新的价格和条件 | 议价成功，供应商收到通知 | 高 |
| TC_QUOTE_003 | 接受报价 | 确认接受操作 | 生成报价确认单 | 高 |
| TC_QUOTE_004 | 超过议价轮次 | 第6轮议价 | 提示超过最大议价轮次 | 中 |
| TC_QUOTE_005 | 报价过期 | 超过有效期的报价 | 提示报价已过期 | 中 |

## 3. 接口测试计划

### 3.1 API接口测试矩阵

| 模块 | 接口数量 | 核心接口 | 测试重点 |
|------|----------|----------|----------|
| 用户认证 | 8 | 登录、注册、权限验证 | 安全性、数据验证 |
| 信息发布 | 12 | 发布、审核、推送 | 业务流程、数据完整性 |
| 搜索匹配 | 10 | 多维搜索、智能推荐 | 性能、准确性 |
| 沟通互动 | 15 | 消息发送、报价议价 | 实时性、可靠性 |
| 商务服务 | 20 | 订单管理、库存管理 | 事务一致性、数据准确性 |
| 技术服务 | 8 | AI问答、专家咨询 | 智能化、响应速度 |
| 招投标 | 10 | 招标发布、投标管理 | 流程完整性、文档生成 |

### 3.2 接口测试用例示例

#### 3.2.1 用户登录接口测试
```python
# 测试用例：TC_API_LOGIN_001
def test_login_success():
    """测试登录成功场景"""
    url = "/api/v1/auth/login"
    data = {
        "username": "test_user",
        "password": "test_password",
        "login_type": "password"
    }
    
    response = client.post(url, json=data)
    
    assert response.status_code == 200
    assert response.json()["code"] == 200
    assert "access_token" in response.json()["data"]
    assert "user_info" in response.json()["data"]

# 测试用例：TC_API_LOGIN_002  
def test_login_invalid_credentials():
    """测试登录凭据错误场景"""
    url = "/api/v1/auth/login"
    data = {
        "username": "test_user",
        "password": "wrong_password",
        "login_type": "password"
    }
    
    response = client.post(url, json=data)
    
    assert response.status_code == 401
    assert response.json()["code"] == 40101
    assert "用户名或密码错误" in response.json()["message"]
```

## 4. 性能测试计划

### 4.1 性能测试指标

#### 4.1.1 响应时间要求
| 功能模块 | 接口类型 | 响应时间要求 | 测试方法 |
|----------|----------|--------------|----------|
| 用户登录 | POST | ≤ 500ms | 单用户测试 |
| 产品搜索 | GET | ≤ 1.5s | 并发测试 |
| 信息发布 | POST | ≤ 1s | 单用户测试 |
| 文件上传 | POST | ≤ 5s (5MB文件) | 文件上传测试 |
| 消息发送 | POST | ≤ 200ms | 实时性测试 |

#### 4.1.2 并发性能要求
| 场景 | 并发用户数 | 持续时间 | 成功率要求 | TPS要求 |
|------|------------|----------|------------|---------|
| 用户登录 | 100 | 5分钟 | ≥ 99% | ≥ 50 |
| 产品搜索 | 500 | 10分钟 | ≥ 95% | ≥ 200 |
| 信息发布 | 100 | 10分钟 | ≥ 99.9% | ≥ 30 |
| 消息通讯 | 1000 | 30分钟 | ≥ 99% | ≥ 100 |

### 4.2 性能测试脚本示例

#### 4.2.1 JMeter测试计划
```xml
<?xml version="1.0" encoding="UTF-8"?>
<jmeterTestPlan version="1.2">
  <hashTree>
    <TestPlan guiclass="TestPlanGui" testclass="TestPlan" testname="天信平台性能测试">
      <elementProp name="TestPlan.arguments" elementType="Arguments" guiclass="ArgumentsPanel">
        <collectionProp name="Arguments.arguments">
          <elementProp name="base_url" elementType="Argument">
            <stringProp name="Argument.name">base_url</stringProp>
            <stringProp name="Argument.value">http://localhost:8000</stringProp>
          </elementProp>
        </collectionProp>
      </elementProp>
    </TestPlan>
    
    <hashTree>
      <!-- 用户登录性能测试 -->
      <ThreadGroup guiclass="ThreadGroupGui" testclass="ThreadGroup" testname="用户登录测试">
        <stringProp name="ThreadGroup.on_sample_error">continue</stringProp>
        <elementProp name="ThreadGroup.main_controller" elementType="LoopController">
          <boolProp name="LoopController.continue_forever">false</boolProp>
          <stringProp name="LoopController.loops">10</stringProp>
        </elementProp>
        <stringProp name="ThreadGroup.num_threads">100</stringProp>
        <stringProp name="ThreadGroup.ramp_time">60</stringProp>
      </ThreadGroup>
      
      <hashTree>
        <HTTPSamplerProxy guiclass="HttpTestSampleGui" testclass="HTTPSamplerProxy" testname="登录请求">
          <elementProp name="HTTPsampler.Arguments" elementType="Arguments">
            <collectionProp name="Arguments.arguments">
              <elementProp name="" elementType="HTTPArgument">
                <boolProp name="HTTPArgument.always_encode">false</boolProp>
                <stringProp name="Argument.value">{"username":"test_user","password":"test_password"}</stringProp>
                <stringProp name="Argument.metadata">=</stringProp>
              </elementProp>
            </collectionProp>
          </elementProp>
          <stringProp name="HTTPSampler.domain">${base_url}</stringProp>
          <stringProp name="HTTPSampler.port"></stringProp>
          <stringProp name="HTTPSampler.path">/api/v1/auth/login</stringProp>
          <stringProp name="HTTPSampler.method">POST</stringProp>
        </HTTPSamplerProxy>
      </hashTree>
    </hashTree>
  </hashTree>
</jmeterTestPlan>
```

## 5. 安全测试计划

### 5.1 安全测试用例

#### 5.1.1 认证安全测试
| 用例ID | 测试场景 | 测试方法 | 预期结果 |
|--------|----------|----------|----------|
| TC_SEC_001 | SQL注入攻击 | 在输入框中输入SQL注入代码 | 系统正确过滤，不执行恶意SQL |
| TC_SEC_002 | XSS攻击 | 输入恶意JavaScript代码 | 系统正确转义，不执行脚本 |
| TC_SEC_003 | CSRF攻击 | 跨站请求伪造 | 系统验证CSRF Token，拒绝请求 |
| TC_SEC_004 | 暴力破解 | 多次错误登录尝试 | 账号临时锁定，限制登录频率 |
| TC_SEC_005 | 权限绕过 | 直接访问无权限的API | 返回403权限不足错误 |

#### 5.1.2 数据安全测试
| 用例ID | 测试场景 | 测试方法 | 预期结果 |
|--------|----------|----------|----------|
| TC_DATA_001 | 敏感数据加密 | 查看数据库存储的敏感信息 | 敏感字段已加密存储 |
| TC_DATA_002 | 数据传输加密 | 抓包分析API请求 | 使用HTTPS加密传输 |
| TC_DATA_003 | 数据访问控制 | 尝试访问其他用户数据 | 系统正确验证权限，拒绝访问 |
| TC_DATA_004 | 数据备份恢复 | 模拟数据丢失场景 | 能够从备份正确恢复数据 |

## 6. 兼容性测试计划

### 6.1 浏览器兼容性测试

#### 6.1.1 支持的浏览器版本
| 浏览器 | 版本要求 | 测试重点 |
|--------|----------|----------|
| Chrome | 90+ | 主要测试浏览器，功能完整性 |
| Firefox | 88+ | 布局兼容性，JavaScript兼容性 |
| Safari | 14+ | CSS兼容性，移动端适配 |
| Edge | 90+ | 企业环境兼容性 |

#### 6.1.2 设备兼容性测试
| 设备类型 | 屏幕尺寸 | 测试重点 |
|----------|----------|----------|
| 桌面端 | 1920x1080, 1366x768 | 布局完整性，功能可用性 |
| 平板端 | 1024x768, 768x1024 | 触控操作，响应式布局 |
| 手机端 | 375x667, 414x896 | 移动端适配，操作便利性 |

## 7. 用户体验测试计划

### 7.1 可用性测试场景

#### 7.1.1 核心业务流程测试
| 流程 | 测试场景 | 成功标准 |
|------|----------|----------|
| 用户注册流程 | 新用户完成注册 | 5分钟内完成注册，流程清晰 |
| 产品发布流程 | 供应商发布产品 | 10分钟内完成发布，操作简单 |
| 采购询价流程 | 企业发起采购询价 | 3分钟内完成询价，步骤明确 |
| 订单交易流程 | 完成一笔交易 | 15分钟内完成交易，状态清晰 |

#### 7.1.2 界面交互测试
| 测试项 | 测试内容 | 评估标准 |
|--------|----------|----------|
| 导航易用性 | 菜单结构、面包屑导航 | 用户能快速找到目标功能 |
| 表单易用性 | 表单填写、验证提示 | 错误提示清晰，填写便捷 |
| 搜索易用性 | 搜索功能、筛选条件 | 搜索结果准确，筛选方便 |
| 响应式设计 | 不同设备适配 | 各设备显示正常，操作流畅 |

## 8. 测试执行计划

### 8.1 测试阶段划分

#### 8.1.1 单元测试阶段 (开发期间)
- **执行时间**: 开发过程中持续进行
- **责任人**: 开发工程师
- **覆盖率要求**: 代码覆盖率 ≥ 80%
- **工具**: pytest (后端), Vitest (前端)

#### 8.1.2 集成测试阶段 (功能开发完成后)
- **执行时间**: 每个功能模块开发完成后
- **责任人**: QA工程师 + 开发工程师
- **测试内容**: 模块间接口、数据流转
- **工具**: Postman, Newman

#### 8.1.3 系统测试阶段 (所有功能开发完成后)
- **执行时间**: 系统集成完成后
- **责任人**: QA团队
- **测试内容**: 端到端业务流程
- **工具**: Selenium, Cypress

#### 8.1.4 验收测试阶段 (系统测试通过后)
- **执行时间**: 正式发布前
- **责任人**: 产品经理 + 业务用户
- **测试内容**: 业务需求验证
- **工具**: 手工测试

### 8.2 测试环境管理

#### 8.2.1 测试数据准备
```python
# 测试数据生成脚本
TEST_DATA_CONFIG = {
    'users': {
        'enterprise_users': 50,      # 企业用户数量
        'individual_users': 100,     # 个人用户数量
        'admin_users': 5             # 管理员用户数量
    },
    'enterprises': {
        'suppliers': 20,             # 供应商企业
        'manufacturers': 15,         # 生产企业
        'constructors': 10,          # 施工企业
        'owners': 5                  # 甲方企业
    },
    'products': {
        'anticorrosion_materials': 100,  # 防腐材料
        'insulation_products': 80,       # 保温产品
        'equipment': 50                  # 设备产品
    },
    'orders': {
        'completed_orders': 200,     # 已完成订单
        'active_orders': 50,         # 进行中订单
        'cancelled_orders': 30       # 已取消订单
    }
}
```

#### 8.2.2 测试环境重置
```bash
#!/bin/bash
# 测试环境重置脚本

echo "开始重置测试环境..."

# 1. 清理数据库
python manage.py flush --noinput

# 2. 重新执行迁移
python manage.py migrate

# 3. 加载测试数据
python manage.py loaddata fixtures/test_data.json

# 4. 清理Redis缓存
redis-cli FLUSHALL

# 5. 重建Elasticsearch索引
python manage.py rebuild_index --noinput

echo "测试环境重置完成"
```

## 9. 测试报告模板

### 9.1 测试执行报告
```markdown
# 测试执行报告

## 测试概要
- **测试版本**: v1.0.0
- **测试时间**: 2024-08-27 ~ 2024-09-03
- **测试环境**: 测试环境
- **测试人员**: QA团队

## 测试结果统计
- **总用例数**: 500
- **执行用例数**: 485
- **通过用例数**: 470
- **失败用例数**: 15
- **阻塞用例数**: 15
- **通过率**: 96.9%

## 功能模块测试结果
| 模块 | 总用例 | 通过 | 失败 | 阻塞 | 通过率 |
|------|--------|------|------|------|--------|
| 用户认证 | 50 | 48 | 2 | 0 | 96% |
| 信息发布 | 80 | 75 | 3 | 2 | 93.8% |
| 搜索匹配 | 60 | 58 | 1 | 1 | 96.7% |
| 沟通互动 | 90 | 85 | 4 | 1 | 94.4% |
| 商务服务 | 120 | 115 | 3 | 2 | 95.8% |
| 技术服务 | 40 | 39 | 1 | 0 | 97.5% |
| 招投标 | 45 | 43 | 1 | 1 | 95.6% |

## 主要问题汇总
### 高优先级问题
1. **BUG-001**: 用户登录后Token过期时间不正确
   - 影响: 用户需要频繁重新登录
   - 状态: 已修复
   
2. **BUG-002**: 产品搜索在大数据量时响应缓慢
   - 影响: 用户体验差
   - 状态: 修复中

### 中优先级问题
1. **BUG-003**: 文件上传进度显示不准确
   - 影响: 用户无法准确了解上传进度
   - 状态: 待修复

## 性能测试结果
- **平均响应时间**: 850ms (要求 ≤ 1000ms) ✅
- **95%响应时间**: 1.2s (要求 ≤ 2s) ✅
- **并发用户支持**: 1000用户 (要求 ≥ 1000) ✅
- **系统稳定性**: 99.5% (要求 ≥ 99%) ✅

## 测试结论
系统整体功能完整，性能满足要求，存在少量中低优先级问题，建议修复后发布。
```

## 10. 测试工具和环境

### 10.1 测试工具选型
- **单元测试**: pytest (后端), Vitest (前端)
- **接口测试**: Postman, Newman
- **性能测试**: JMeter, Locust
- **UI自动化测试**: Selenium, Cypress
- **安全测试**: OWASP ZAP, Burp Suite
- **代码质量**: SonarQube, ESLint

### 10.2 持续集成测试
```yaml
# .github/workflows/test.yml
name: 自动化测试

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  backend-test:
    runs-on: ubuntu-latest
    services:
      mysql:
        image: mysql:8.0
        env:
          MYSQL_ROOT_PASSWORD: root
          MYSQL_DATABASE: test_txgy
        options: >-
          --health-cmd="mysqladmin ping"
          --health-interval=10s
          --health-timeout=5s
          --health-retries=3
      
      redis:
        image: redis:6
        options: >-
          --health-cmd="redis-cli ping"
          --health-interval=10s
          --health-timeout=5s
          --health-retries=3
    
    steps:
    - uses: actions/checkout@v3
    
    - name: 设置Python环境
      uses: actions/setup-python@v4
      with:
        python-version: '3.12'
    
    - name: 安装依赖
      run: |
        cd txgy_api
        pip install -r requirements/development.txt
    
    - name: 运行测试
      run: |
        cd txgy_api
        python manage.py test
        coverage run --source='.' manage.py test
        coverage xml
    
    - name: 上传覆盖率报告
      uses: codecov/codecov-action@v3

  frontend-test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: 设置Node.js环境
      uses: actions/setup-node@v3
      with:
        node-version: '18'
    
    - name: 安装依赖
      run: |
        cd txgy_frontend
        npm ci
    
    - name: 运行测试
      run: |
        cd txgy_frontend
        npm run test:coverage
    
    - name: 构建检查
      run: |
        cd txgy_frontend
        npm run build
```
