# 防腐保温智慧平台数据库设计文档

## 1. 数据库架构概述

### 1.1 技术选型
- **主数据库**: MySQL 8.0+
- **缓存数据库**: Redis 6.0+
- **搜索引擎**: Elasticsearch 8.0+

### 1.2 数据库分层设计
- **业务数据层**: MySQL存储核心业务数据
- **缓存层**: Redis存储热点数据和会话信息
- **搜索层**: Elasticsearch存储全文检索数据

## 2. 核心数据表设计

### 2.1 用户管理相关表

#### 2.1.1 用户基础信息表 (tx_users)

```sql
CREATE TABLE tx_users (
    user_id VARCHAR(32) PRIMARY KEY COMMENT '用户ID，格式：USR-YYYYMM-XXX',
    username VARCHAR(50) NOT NULL UNIQUE COMMENT '用户名',
    password_hash VARCHAR(255) NOT NULL COMMENT '密码哈希',
    email VARCHAR(100) UNIQUE COMMENT '邮箱地址',
    phone VARCHAR(11) UNIQUE COMMENT '手机号码',
    user_type ENUM('enterprise', 'individual') NOT NULL COMMENT '用户类型',
    real_name VARCHAR(50) COMMENT '真实姓名',
    avatar_url VARCHAR(255) COMMENT '头像URL',
    status ENUM('active', 'inactive', 'pending_review', 'banned') DEFAULT 'pending_review' COMMENT '用户状态',
    last_login_time DATETIME COMMENT '最后登录时间',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    INDEX idx_username (username),
    INDEX idx_phone (phone),
    INDEX idx_user_type (user_type),
    INDEX idx_status (status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户基础信息表';
```

#### 2.1.2 企业信息表 (tx_enterprises)

```sql
CREATE TABLE tx_enterprises (
    enterprise_id VARCHAR(32) PRIMARY KEY COMMENT '企业ID，格式：ENT-YYYYMM-XXX',
    user_id VARCHAR(32) NOT NULL COMMENT '关联用户ID',
    company_name VARCHAR(100) NOT NULL COMMENT '企业名称',
    company_type ENUM('manufacturer', 'constructor', 'owner', 'supplier') NOT NULL COMMENT '企业类型',
    business_license VARCHAR(50) UNIQUE COMMENT '营业执照号',
    contact_person VARCHAR(50) COMMENT '联系人',
    contact_phone VARCHAR(11) COMMENT '联系电话',
    contact_email VARCHAR(100) COMMENT '联系邮箱',
    address VARCHAR(200) COMMENT '企业地址',
    province VARCHAR(20) COMMENT '省份',
    city VARCHAR(20) COMMENT '城市',
    district VARCHAR(20) COMMENT '区县',
    business_scope TEXT COMMENT '经营范围',
    registered_capital DECIMAL(15,2) COMMENT '注册资本',
    established_year YEAR COMMENT '成立年份',
    annual_output VARCHAR(100) COMMENT '年产量',
    employee_count INT COMMENT '员工数量',
    certification_status ENUM('verified', 'pending', 'rejected') DEFAULT 'pending' COMMENT '认证状态',
    rating ENUM('1star', '2star', '3star', '4star', '5star') COMMENT '企业评级',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES tx_users(user_id) ON DELETE CASCADE,
    INDEX idx_company_name (company_name),
    INDEX idx_company_type (company_type),
    INDEX idx_region (province, city, district),
    INDEX idx_rating (rating)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='企业信息表';
```

#### 2.1.3 用户权限表 (tx_user_permissions)

```sql
CREATE TABLE tx_user_permissions (
    permission_id VARCHAR(32) PRIMARY KEY,
    user_id VARCHAR(32) NOT NULL COMMENT '用户ID',
    permission_code VARCHAR(50) NOT NULL COMMENT '权限代码',
    permission_name VARCHAR(100) NOT NULL COMMENT '权限名称',
    module_name VARCHAR(50) NOT NULL COMMENT '所属模块',
    granted_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '授权时间',
    expires_at DATETIME COMMENT '过期时间',
    granted_by VARCHAR(32) COMMENT '授权人ID',
    FOREIGN KEY (user_id) REFERENCES tx_users(user_id) ON DELETE CASCADE,
    INDEX idx_user_permissions (user_id, permission_code),
    INDEX idx_module (module_name)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户权限表';
```

### 2.2 产品信息相关表

#### 2.2.1 产品信息表 (tx_products)

```sql
CREATE TABLE tx_products (
    product_id VARCHAR(32) PRIMARY KEY COMMENT '产品ID，格式：PROD-YYYYMMDD-XXX',
    supplier_id VARCHAR(32) NOT NULL COMMENT '供应商ID',
    product_name VARCHAR(50) NOT NULL COMMENT '产品名称',
    product_type VARCHAR(50) NOT NULL COMMENT '产品类型',
    product_category_l1 VARCHAR(50) COMMENT '一级分类',
    product_category_l2 VARCHAR(50) COMMENT '二级分类',
    technical_params JSON COMMENT '技术参数JSON',
    unit_price DECIMAL(10,2) COMMENT '单价',
    price_unit VARCHAR(20) COMMENT '价格单位',
    min_order_quantity INT DEFAULT 1 COMMENT '最小起订量',
    supply_capacity INT COMMENT '供货能力',
    delivery_period INT COMMENT '供货周期（天）',
    production_standard VARCHAR(100) COMMENT '生产标准',
    quality_report_url VARCHAR(255) COMMENT '质检报告URL',
    product_description TEXT COMMENT '产品描述',
    status ENUM('draft', 'pending_review', 'published', 'rejected', 'offline') DEFAULT 'draft' COMMENT '产品状态',
    view_count INT DEFAULT 0 COMMENT '浏览次数',
    inquiry_count INT DEFAULT 0 COMMENT '询价次数',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (supplier_id) REFERENCES tx_enterprises(enterprise_id) ON DELETE CASCADE,
    INDEX idx_supplier (supplier_id),
    INDEX idx_product_type (product_type),
    INDEX idx_category (product_category_l1, product_category_l2),
    INDEX idx_status (status),
    INDEX idx_price (unit_price),
    FULLTEXT idx_name_desc (product_name, product_description)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='产品信息表';
```

#### 2.2.2 产品媒体文件表 (tx_product_media)

```sql
CREATE TABLE tx_product_media (
    media_id VARCHAR(32) PRIMARY KEY,
    product_id VARCHAR(32) NOT NULL COMMENT '产品ID',
    media_type ENUM('image', 'video') NOT NULL COMMENT '媒体类型',
    media_url VARCHAR(255) NOT NULL COMMENT '媒体文件URL',
    media_name VARCHAR(100) COMMENT '文件名称',
    file_size INT COMMENT '文件大小（字节）',
    sort_order INT DEFAULT 0 COMMENT '排序序号',
    is_primary BOOLEAN DEFAULT FALSE COMMENT '是否为主图',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (product_id) REFERENCES tx_products(product_id) ON DELETE CASCADE,
    INDEX idx_product_media (product_id, media_type)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='产品媒体文件表';
```

#### 2.2.3 库存管理表 (tx_inventory)

```sql
CREATE TABLE tx_inventory (
    inventory_id VARCHAR(32) PRIMARY KEY,
    product_id VARCHAR(32) NOT NULL COMMENT '产品ID',
    supplier_id VARCHAR(32) NOT NULL COMMENT '供应商ID',
    warehouse_location VARCHAR(100) COMMENT '仓库位置',
    current_quantity INT NOT NULL DEFAULT 0 COMMENT '当前库存数量',
    available_quantity INT NOT NULL DEFAULT 0 COMMENT '可用库存数量',
    reserved_quantity INT DEFAULT 0 COMMENT '预留库存数量',
    low_stock_threshold INT DEFAULT 0 COMMENT '缺货预警阈值',
    overstock_threshold INT DEFAULT 0 COMMENT '积压预警阈值',
    batch_number VARCHAR(50) COMMENT '批次号',
    production_date DATE COMMENT '生产日期',
    expiry_date DATE COMMENT '有效期',
    cost_price DECIMAL(10,2) COMMENT '成本价',
    last_updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '最后更新时间',
    updated_by VARCHAR(32) COMMENT '更新人ID',
    FOREIGN KEY (product_id) REFERENCES tx_products(product_id) ON DELETE CASCADE,
    FOREIGN KEY (supplier_id) REFERENCES tx_enterprises(enterprise_id) ON DELETE CASCADE,
    INDEX idx_product_inventory (product_id),
    INDEX idx_supplier_inventory (supplier_id),
    INDEX idx_quantity (current_quantity),
    INDEX idx_updated_time (last_updated_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='库存管理表';
```

### 2.3 需求信息相关表

#### 2.3.1 采购需求表 (tx_purchase_demands)

```sql
CREATE TABLE tx_purchase_demands (
    demand_id VARCHAR(32) PRIMARY KEY COMMENT '需求ID，格式：DEM-YYYYMMDD-XXX',
    buyer_id VARCHAR(32) NOT NULL COMMENT '采购方企业ID',
    product_type VARCHAR(50) NOT NULL COMMENT '需求产品类型',
    purchase_quantity INT NOT NULL COMMENT '采购数量',
    quantity_unit VARCHAR(20) NOT NULL COMMENT '数量单位',
    quality_requirements VARCHAR(100) NOT NULL COMMENT '质量要求',
    delivery_period INT NOT NULL COMMENT '交货周期（天）',
    delivery_location VARCHAR(200) NOT NULL COMMENT '交货地点',
    delivery_province VARCHAR(20) COMMENT '交货省份',
    delivery_city VARCHAR(20) COMMENT '交货城市',
    delivery_district VARCHAR(20) COMMENT '交货区县',
    budget_amount DECIMAL(12,2) COMMENT '预算金额',
    demand_validity INT NOT NULL DEFAULT 7 COMMENT '需求有效期（天）',
    technical_specs TEXT COMMENT '技术规格说明',
    contact_person VARCHAR(50) COMMENT '联系人',
    contact_phone VARCHAR(11) COMMENT '联系电话',
    contact_email VARCHAR(100) COMMENT '联系邮箱',
    status ENUM('draft', 'published', 'matched', 'closed', 'expired') DEFAULT 'draft' COMMENT '需求状态',
    response_count INT DEFAULT 0 COMMENT '响应数量',
    view_count INT DEFAULT 0 COMMENT '浏览次数',
    expires_at DATETIME COMMENT '需求过期时间',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (buyer_id) REFERENCES tx_enterprises(enterprise_id) ON DELETE CASCADE,
    INDEX idx_buyer (buyer_id),
    INDEX idx_product_type (product_type),
    INDEX idx_location (delivery_province, delivery_city),
    INDEX idx_status (status),
    INDEX idx_expires (expires_at),
    INDEX idx_budget (budget_amount)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='采购需求表';
```

#### 2.3.2 需求响应表 (tx_demand_responses)

```sql
CREATE TABLE tx_demand_responses (
    response_id VARCHAR(32) PRIMARY KEY COMMENT '响应ID，格式：RES-YYYYMMDD-XXX',
    demand_id VARCHAR(32) NOT NULL COMMENT '需求ID',
    supplier_id VARCHAR(32) NOT NULL COMMENT '供应商ID',
    quoted_price DECIMAL(12,2) NOT NULL COMMENT '报价金额',
    quotation_validity INT NOT NULL COMMENT '报价有效期（天）',
    delivery_period INT NOT NULL COMMENT '交货周期（天）',
    customization_note VARCHAR(200) COMMENT '定制化说明',
    supply_capacity_proof VARCHAR(255) COMMENT '供货能力证明文件URL',
    payment_terms VARCHAR(100) COMMENT '付款条件',
    response_status ENUM('pending', 'accepted', 'rejected', 'expired') DEFAULT 'pending' COMMENT '响应状态',
    buyer_feedback TEXT COMMENT '采购方反馈',
    responded_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '响应时间',
    expires_at DATETIME COMMENT '报价过期时间',
    FOREIGN KEY (demand_id) REFERENCES tx_purchase_demands(demand_id) ON DELETE CASCADE,
    FOREIGN KEY (supplier_id) REFERENCES tx_enterprises(enterprise_id) ON DELETE CASCADE,
    INDEX idx_demand_responses (demand_id),
    INDEX idx_supplier_responses (supplier_id),
    INDEX idx_status (response_status),
    INDEX idx_expires (expires_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='需求响应表';
```

### 2.4 招聘信息相关表

#### 2.4.1 招聘信息表 (tx_recruitments)

```sql
CREATE TABLE tx_recruitments (
    recruitment_id VARCHAR(32) PRIMARY KEY COMMENT '招聘ID，格式：REC-YYYYMMDD-XXX',
    company_id VARCHAR(32) NOT NULL COMMENT '招聘企业ID',
    position_name VARCHAR(30) NOT NULL COMMENT '岗位名称',
    position_type ENUM('technical', 'construction', 'procurement', 'management') NOT NULL COMMENT '岗位类型',
    work_location VARCHAR(100) NOT NULL COMMENT '工作地点',
    work_province VARCHAR(20) COMMENT '工作省份',
    work_city VARCHAR(20) COMMENT '工作城市',
    salary_range VARCHAR(50) NOT NULL COMMENT '薪资范围',
    education_requirement ENUM('college', 'bachelor', 'master', 'phd') NOT NULL COMMENT '学历要求',
    experience_requirement ENUM('0-1years', '1-3years', '3-5years', '5+years') NOT NULL COMMENT '经验要求',
    position_requirements VARCHAR(500) NOT NULL COMMENT '岗位要求',
    job_description TEXT COMMENT '职位描述',
    benefits TEXT COMMENT '福利待遇',
    recruitment_deadline DATE NOT NULL COMMENT '招聘截止日期',
    contact_person VARCHAR(50) COMMENT '联系人',
    contact_phone VARCHAR(11) COMMENT '联系电话',
    contact_email VARCHAR(100) COMMENT '联系邮箱',
    status ENUM('draft', 'published', 'closed', 'expired') DEFAULT 'draft' COMMENT '招聘状态',
    application_count INT DEFAULT 0 COMMENT '应聘数量',
    view_count INT DEFAULT 0 COMMENT '浏览次数',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (company_id) REFERENCES tx_enterprises(enterprise_id) ON DELETE CASCADE,
    INDEX idx_company (company_id),
    INDEX idx_position_type (position_type),
    INDEX idx_location (work_province, work_city),
    INDEX idx_status (status),
    INDEX idx_deadline (recruitment_deadline)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='招聘信息表';
```

#### 2.4.2 应聘申请表 (tx_job_applications)

```sql
CREATE TABLE tx_job_applications (
    application_id VARCHAR(32) PRIMARY KEY COMMENT '应聘ID，格式：APP-YYYYMMDD-XXX',
    recruitment_id VARCHAR(32) NOT NULL COMMENT '招聘ID',
    applicant_id VARCHAR(32) NOT NULL COMMENT '应聘者用户ID',
    resume_url VARCHAR(255) NOT NULL COMMENT '简历文件URL',
    cover_letter TEXT COMMENT '求职意向说明',
    expected_salary VARCHAR(50) COMMENT '期望薪资',
    available_start_date DATE COMMENT '可入职日期',
    application_status ENUM('submitted', 'reviewed', 'interview_invited', 'accepted', 'rejected') DEFAULT 'submitted' COMMENT '申请状态',
    hr_feedback TEXT COMMENT 'HR反馈',
    interview_time DATETIME COMMENT '面试时间',
    applied_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '申请时间',
    reviewed_at DATETIME COMMENT '审核时间',
    FOREIGN KEY (recruitment_id) REFERENCES tx_recruitments(recruitment_id) ON DELETE CASCADE,
    FOREIGN KEY (applicant_id) REFERENCES tx_users(user_id) ON DELETE CASCADE,
    INDEX idx_recruitment (recruitment_id),
    INDEX idx_applicant (applicant_id),
    INDEX idx_status (application_status),
    INDEX idx_applied_time (applied_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='应聘申请表';
```

#### 2.6.2 技术问题回答表 (tx_technical_answers)

```sql
CREATE TABLE tx_technical_answers (
    answer_id VARCHAR(32) PRIMARY KEY COMMENT '回答ID，格式：ANS-YYYYMMDD-XXX',
    question_id VARCHAR(32) NOT NULL COMMENT '问题ID',
    answerer_id VARCHAR(32) NOT NULL COMMENT '回答者用户ID',
    answerer_type ENUM('ai', 'expert', 'supplier', 'user') NOT NULL COMMENT '回答者类型',
    answer_content TEXT NOT NULL COMMENT '回答内容',
    confidence_score DECIMAL(3,2) COMMENT 'AI回答置信度',
    is_best_answer BOOLEAN DEFAULT FALSE COMMENT '是否为最佳答案',
    like_count INT DEFAULT 0 COMMENT '点赞数量',
    dislike_count INT DEFAULT 0 COMMENT '踩数量',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (question_id) REFERENCES tx_technical_questions(question_id) ON DELETE CASCADE,
    FOREIGN KEY (answerer_id) REFERENCES tx_users(user_id) ON DELETE CASCADE,
    INDEX idx_question_answers (question_id),
    INDEX idx_answerer (answerer_id),
    INDEX idx_answerer_type (answerer_type),
    INDEX idx_best_answer (is_best_answer)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='技术问题回答表';
```

### 2.7 招投标相关表

#### 2.7.1 招标信息表 (tx_tenders)

```sql
CREATE TABLE tx_tenders (
    tender_id VARCHAR(32) PRIMARY KEY COMMENT '招标ID，格式：BID-YYYYMMDD-XXX',
    owner_id VARCHAR(32) NOT NULL COMMENT '招标方企业ID',
    project_name VARCHAR(50) NOT NULL COMMENT '项目名称',
    bidding_type ENUM('public', 'invitation') NOT NULL COMMENT '招标类型',
    project_budget DECIMAL(15,2) NOT NULL COMMENT '项目预算',
    project_location VARCHAR(100) COMMENT '项目地点',
    project_province VARCHAR(20) COMMENT '项目省份',
    project_city VARCHAR(20) COMMENT '项目城市',
    construction_period INT COMMENT '施工周期（天）',
    bidding_deadline DATETIME NOT NULL COMMENT '招标截止时间',
    qualification_requirements VARCHAR(500) NOT NULL COMMENT '投标资质要求',
    project_description TEXT COMMENT '项目描述',
    payment_terms TEXT COMMENT '付款条件',
    contact_person VARCHAR(50) COMMENT '联系人',
    contact_phone VARCHAR(11) COMMENT '联系电话',
    contact_email VARCHAR(100) COMMENT '联系邮箱',
    status ENUM('draft', 'published', 'bidding', 'evaluation', 'awarded', 'cancelled') DEFAULT 'draft' COMMENT '招标状态',
    bid_count INT DEFAULT 0 COMMENT '投标数量',
    view_count INT DEFAULT 0 COMMENT '浏览次数',
    winner_id VARCHAR(32) COMMENT '中标企业ID',
    award_amount DECIMAL(15,2) COMMENT '中标金额',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (owner_id) REFERENCES tx_enterprises(enterprise_id) ON DELETE CASCADE,
    INDEX idx_owner (owner_id),
    INDEX idx_location (project_province, project_city),
    INDEX idx_status (status),
    INDEX idx_deadline (bidding_deadline),
    INDEX idx_budget (project_budget)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='招标信息表';
```

### 2.8 沟通交流相关表

#### 2.8.1 会话表 (tx_conversations)

```sql
CREATE TABLE tx_conversations (
    conversation_id VARCHAR(32) PRIMARY KEY COMMENT '会话ID，格式：CONV-YYYYMMDD-XXX',
    initiator_id VARCHAR(32) NOT NULL COMMENT '发起方用户ID',
    participant_id VARCHAR(32) NOT NULL COMMENT '参与方用户ID',
    conversation_type ENUM('inquiry', 'cooperation', 'technical_support', 'negotiation') NOT NULL COMMENT '会话类型',
    related_resource_id VARCHAR(32) COMMENT '关联资源ID（产品/需求/项目等）',
    related_resource_type ENUM('product', 'demand', 'cooperation', 'tender') COMMENT '关联资源类型',
    conversation_status ENUM('active', 'archived', 'blocked') DEFAULT 'active' COMMENT '会话状态',
    last_message_time DATETIME COMMENT '最后消息时间',
    last_message_content VARCHAR(200) COMMENT '最后消息内容预览',
    unread_count_initiator INT DEFAULT 0 COMMENT '发起方未读消息数',
    unread_count_participant INT DEFAULT 0 COMMENT '参与方未读消息数',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (initiator_id) REFERENCES tx_users(user_id) ON DELETE CASCADE,
    FOREIGN KEY (participant_id) REFERENCES tx_users(user_id) ON DELETE CASCADE,
    INDEX idx_initiator (initiator_id),
    INDEX idx_participant (participant_id),
    INDEX idx_conversation_type (conversation_type),
    INDEX idx_status (conversation_status),
    INDEX idx_last_message_time (last_message_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='会话表';
```

#### 2.8.2 消息表 (tx_messages)

```sql
CREATE TABLE tx_messages (
    message_id VARCHAR(32) PRIMARY KEY COMMENT '消息ID，格式：MSG-YYYYMMDD-XXX',
    conversation_id VARCHAR(32) NOT NULL COMMENT '会话ID',
    sender_id VARCHAR(32) NOT NULL COMMENT '发送者用户ID',
    message_type ENUM('text', 'file', 'image', 'quotation', 'system') NOT NULL COMMENT '消息类型',
    content TEXT COMMENT '消息内容',
    file_url VARCHAR(255) COMMENT '文件URL',
    file_name VARCHAR(100) COMMENT '文件名称',
    file_size INT COMMENT '文件大小（字节）',
    quotation_data JSON COMMENT '报价数据JSON',
    is_read BOOLEAN DEFAULT FALSE COMMENT '是否已读',
    is_recalled BOOLEAN DEFAULT FALSE COMMENT '是否已撤回',
    read_at DATETIME COMMENT '已读时间',
    recalled_at DATETIME COMMENT '撤回时间',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (conversation_id) REFERENCES tx_conversations(conversation_id) ON DELETE CASCADE,
    FOREIGN KEY (sender_id) REFERENCES tx_users(user_id) ON DELETE CASCADE,
    INDEX idx_conversation_messages (conversation_id, created_at),
    INDEX idx_sender (sender_id),
    INDEX idx_message_type (message_type),
    INDEX idx_read_status (is_read)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='消息表';
```

### 2.9 订单交易相关表

#### 2.9.1 订单表 (tx_orders)

```sql
CREATE TABLE tx_orders (
    order_id VARCHAR(32) PRIMARY KEY COMMENT '订单ID，格式：ORD-YYYYMMDD-XXX',
    order_number VARCHAR(50) UNIQUE NOT NULL COMMENT '订单编号',
    buyer_id VARCHAR(32) NOT NULL COMMENT '采购方企业ID',
    supplier_id VARCHAR(32) NOT NULL COMMENT '供应商企业ID',
    related_demand_id VARCHAR(32) COMMENT '关联采购需求ID',
    total_amount DECIMAL(12,2) NOT NULL COMMENT '订单总金额',
    payment_terms VARCHAR(100) COMMENT '付款条件',
    delivery_address VARCHAR(200) NOT NULL COMMENT '交货地址',
    delivery_contact VARCHAR(50) COMMENT '收货联系人',
    delivery_phone VARCHAR(11) COMMENT '收货联系电话',
    expected_delivery_date DATE COMMENT '预计交货日期',
    actual_delivery_date DATE COMMENT '实际交货日期',
    order_status ENUM('pending_confirm', 'confirmed', 'production', 'shipped', 'delivered', 'completed', 'cancelled') DEFAULT 'pending_confirm' COMMENT '订单状态',
    tracking_number VARCHAR(50) COMMENT '物流单号',
    contract_url VARCHAR(255) COMMENT '合同文件URL',
    special_requirements TEXT COMMENT '特殊要求',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (buyer_id) REFERENCES tx_enterprises(enterprise_id) ON DELETE CASCADE,
    FOREIGN KEY (supplier_id) REFERENCES tx_enterprises(enterprise_id) ON DELETE CASCADE,
    INDEX idx_buyer (buyer_id),
    INDEX idx_supplier (supplier_id),
    INDEX idx_order_number (order_number),
    INDEX idx_status (order_status),
    INDEX idx_delivery_date (expected_delivery_date)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单表';
```

#### 2.9.2 订单明细表 (tx_order_items)

```sql
CREATE TABLE tx_order_items (
    item_id VARCHAR(32) PRIMARY KEY,
    order_id VARCHAR(32) NOT NULL COMMENT '订单ID',
    product_id VARCHAR(32) NOT NULL COMMENT '产品ID',
    product_name VARCHAR(50) NOT NULL COMMENT '产品名称',
    product_specification VARCHAR(200) COMMENT '产品规格',
    quantity INT NOT NULL COMMENT '订购数量',
    unit VARCHAR(20) NOT NULL COMMENT '单位',
    unit_price DECIMAL(10,2) NOT NULL COMMENT '单价',
    total_price DECIMAL(12,2) NOT NULL COMMENT '小计金额',
    technical_requirements TEXT COMMENT '技术要求',
    delivery_status ENUM('pending', 'partial', 'completed') DEFAULT 'pending' COMMENT '交货状态',
    delivered_quantity INT DEFAULT 0 COMMENT '已交货数量',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (order_id) REFERENCES tx_orders(order_id) ON DELETE CASCADE,
    FOREIGN KEY (product_id) REFERENCES tx_products(product_id) ON DELETE CASCADE,
    INDEX idx_order_items (order_id),
    INDEX idx_product_orders (product_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='订单明细表';
```

### 2.5 项目合作相关表

#### 2.5.1 项目合作信息表 (tx_project_cooperations)

```sql
CREATE TABLE tx_project_cooperations (
    cooperation_id VARCHAR(32) PRIMARY KEY COMMENT '合作ID，格式：COOP-YYYYMMDD-XXX',
    publisher_id VARCHAR(32) NOT NULL COMMENT '发布方企业ID',
    project_name VARCHAR(50) NOT NULL COMMENT '项目名称',
    project_type ENUM('subcontract', 'equipment_sharing', 'technical_cooperation') NOT NULL COMMENT '项目类型',
    project_location VARCHAR(100) COMMENT '项目地点',
    project_province VARCHAR(20) COMMENT '项目省份',
    project_city VARCHAR(20) COMMENT '项目城市',
    cooperation_budget DECIMAL(12,2) COMMENT '合作预算',
    project_period INT COMMENT '项目周期（天）',
    start_date DATE COMMENT '预计开始日期',
    end_date DATE COMMENT '预计结束日期',
    cooperation_requirements TEXT NOT NULL COMMENT '合作要求',
    qualification_requirements TEXT COMMENT '资质要求',
    contact_person VARCHAR(50) COMMENT '联系人',
    contact_phone VARCHAR(11) COMMENT '联系电话',
    contact_email VARCHAR(100) COMMENT '联系邮箱',
    status ENUM('draft', 'published', 'in_negotiation', 'confirmed', 'completed', 'cancelled') DEFAULT 'draft' COMMENT '合作状态',
    application_count INT DEFAULT 0 COMMENT '申请数量',
    view_count INT DEFAULT 0 COMMENT '浏览次数',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (publisher_id) REFERENCES tx_enterprises(enterprise_id) ON DELETE CASCADE,
    INDEX idx_publisher (publisher_id),
    INDEX idx_project_type (project_type),
    INDEX idx_location (project_province, project_city),
    INDEX idx_status (status),
    INDEX idx_budget (cooperation_budget)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='项目合作信息表';
```

### 2.6 技术问答相关表

#### 2.6.1 技术问题表 (tx_technical_questions)

```sql
CREATE TABLE tx_technical_questions (
    question_id VARCHAR(32) PRIMARY KEY COMMENT '问题ID，格式：QST-YYYYMMDD-XXX',
    questioner_id VARCHAR(32) NOT NULL COMMENT '提问者用户ID',
    question_category ENUM('material', 'construction', 'equipment', 'product_tech') NOT NULL COMMENT '问题分类',
    question_title VARCHAR(50) NOT NULL COMMENT '问题标题',
    question_content VARCHAR(1000) NOT NULL COMMENT '问题内容',
    urgency_level ENUM('low', 'medium', 'high') DEFAULT 'medium' COMMENT '紧急程度',
    reward_points INT DEFAULT 0 COMMENT '悬赏积分',
    related_product_id VARCHAR(32) COMMENT '关联产品ID',
    project_context TEXT COMMENT '项目背景',
    status ENUM('open', 'answered', 'resolved', 'closed') DEFAULT 'open' COMMENT '问题状态',
    best_answer_id VARCHAR(32) COMMENT '最佳答案ID',
    answer_count INT DEFAULT 0 COMMENT '回答数量',
    view_count INT DEFAULT 0 COMMENT '浏览次数',
    like_count INT DEFAULT 0 COMMENT '点赞数量',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (questioner_id) REFERENCES tx_users(user_id) ON DELETE CASCADE,
    INDEX idx_questioner (questioner_id),
    INDEX idx_category (question_category),
    INDEX idx_status (status),
    INDEX idx_urgency (urgency_level),
    INDEX idx_created_time (created_at),
    FULLTEXT idx_title_content (question_title, question_content)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='技术问题表';
```
