<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¼ºåˆ¶èœå•æ˜¾ç¤ºæµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .title {
            font-size: 28px;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #666;
            font-size: 16px;
        }
        .action-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 15px;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .btn:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }
        .btn.success {
            background: #28a745;
        }
        .btn.success:hover {
            background: #218838;
        }
        .btn.danger {
            background: #dc3545;
        }
        .btn.danger:hover {
            background: #c82333;
        }
        .status {
            padding: 12px;
            margin: 10px 0;
            border-radius: 6px;
            font-weight: 500;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        .quick-links {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        .link-btn {
            background: #6c757d;
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 13px;
            transition: all 0.3s ease;
        }
        .link-btn:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">ğŸ”§ å¼ºåˆ¶èœå•æ˜¾ç¤ºæµ‹è¯•</h1>
            <p class="subtitle">ç›´æ¥è®¾ç½®ç™»å½•çŠ¶æ€å¹¶å¼ºåˆ¶æ˜¾ç¤ºèœå•</p>
        </div>

        <!-- æ­¥éª¤1ï¼šè®¾ç½®ç™»å½•çŠ¶æ€ -->
        <div class="action-section">
            <div class="section-title">æ­¥éª¤1ï¼šè®¾ç½®ç™»å½•çŠ¶æ€</div>
            <div id="login-status" class="status info">ç‚¹å‡»æŒ‰é’®è®¾ç½®ç™»å½•çŠ¶æ€...</div>
            <button class="btn success" onclick="forceLogin()">å¼ºåˆ¶è®¾ç½®ç™»å½•çŠ¶æ€</button>
            <button class="btn danger" onclick="clearLogin()">æ¸…é™¤ç™»å½•çŠ¶æ€</button>
            <div id="login-info" class="code-block"></div>
        </div>

        <!-- æ­¥éª¤2ï¼šæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å° -->
        <div class="action-section">
            <div class="section-title">æ­¥éª¤2ï¼šæ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°</div>
            <div class="status info">
                è¯·æŒ‰F12æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ŒæŸ¥çœ‹Consoleæ ‡ç­¾é¡µä¸­çš„è°ƒè¯•ä¿¡æ¯ã€‚
                æˆ‘ä»¬æ·»åŠ äº†è¯¦ç»†çš„æ—¥å¿—æ¥è¿½è¸ªèœå•åŠ è½½è¿‡ç¨‹ã€‚
            </div>
            <div class="code-block">
é¢„æœŸçœ‹åˆ°çš„æ—¥å¿—ï¼š
ğŸ”„ å¼€å§‹åŠ è½½ç”¨æˆ·èœå•å’Œæƒé™...
ğŸ“Š é»˜è®¤èœå•æ•°é‡: 5
ğŸ¯ menuListè®¡ç®—å±æ€§è¢«è°ƒç”¨
ğŸ“Š allMenus.valueé•¿åº¦: 5
âœ… å¤„ç†åçš„èœå•: ä»ªè¡¨ç›˜, å­èœå•æ•°é‡: 0
âœ… å¤„ç†åçš„èœå•: ç”¨æˆ·ç®¡ç†, å­èœå•æ•°é‡: 0
...
ğŸ¯ æœ€ç»ˆèœå•æ•°é‡: 5
            </div>
        </div>

        <!-- æ­¥éª¤3ï¼šè®¿é—®ç®¡ç†åå° -->
        <div class="action-section">
            <div class="section-title">æ­¥éª¤3ï¼šè®¿é—®ç®¡ç†åå°</div>
            <div id="access-status" class="status info">è®¾ç½®ç™»å½•çŠ¶æ€åï¼Œç‚¹å‡»ä¸‹é¢çš„é“¾æ¥è®¿é—®ç®¡ç†åå°</div>
            <div class="quick-links">
                <a href="/admin" class="link-btn" target="_blank">ç®¡ç†åå°é¦–é¡µ</a>
                <a href="/admin/users" class="link-btn" target="_blank">ç”¨æˆ·ç®¡ç†</a>
                <a href="/admin/menus" class="link-btn" target="_blank">èœå•ç®¡ç†</a>
            </div>
        </div>

        <!-- æ­¥éª¤4ï¼šæ‰‹åŠ¨è°ƒè¯• -->
        <div class="action-section">
            <div class="section-title">æ­¥éª¤4ï¼šæ‰‹åŠ¨è°ƒè¯•ï¼ˆé«˜çº§ï¼‰</div>
            <div class="status info">
                å¦‚æœä¸Šè¿°æ­¥éª¤ä»ç„¶æ— æ•ˆï¼Œè¯·åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­è¿è¡Œä»¥ä¸‹ä»£ç è¿›è¡Œæ‰‹åŠ¨è°ƒè¯•ï¼š
            </div>
            <div class="code-block">
// æ£€æŸ¥Vueåº”ç”¨å®ä¾‹
console.log('Vueåº”ç”¨:', window.__VUE_DEVTOOLS_GLOBAL_HOOK__?.apps?.[0]);

// æ£€æŸ¥Pinia store
const app = window.__VUE_DEVTOOLS_GLOBAL_HOOK__?.apps?.[0];
if (app) {
  const pinia = app._instance?.appContext?.app?.config?.globalProperties?.$pinia;
  console.log('Piniaå®ä¾‹:', pinia);
  
  if (pinia) {
    const menuStore = pinia._s.get('menu');
    console.log('èœå•Store:', menuStore);
    console.log('allMenus:', menuStore?.allMenus);
    console.log('menuList:', menuStore?.menuList);
    
    // å¼ºåˆ¶é‡æ–°åŠ è½½èœå•
    if (menuStore) {
      menuStore.loadUserMenus().then(() => {
        console.log('èœå•é‡æ–°åŠ è½½å®Œæˆ');
        console.log('æ–°çš„menuList:', menuStore.menuList);
      });
    }
  }
}
            </div>
            <button class="btn" onclick="copyDebugCode()">å¤åˆ¶è°ƒè¯•ä»£ç </button>
        </div>

        <!-- æ­¥éª¤5ï¼šæ£€æŸ¥ç½‘ç»œè¯·æ±‚ -->
        <div class="action-section">
            <div class="section-title">æ­¥éª¤5ï¼šæ£€æŸ¥ç½‘ç»œè¯·æ±‚</div>
            <div class="status info">
                åœ¨å¼€å‘è€…å·¥å…·çš„Networkæ ‡ç­¾é¡µä¸­ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰å¤±è´¥çš„APIè¯·æ±‚ã€‚
                ç‰¹åˆ«å…³æ³¨ /api/auth/permissions è¿™ä¸ªè¯·æ±‚ã€‚
            </div>
        </div>
    </div>

    <script>
        function updateStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            if (element) {
                element.className = `status ${type}`;
                element.textContent = message;
            }
        }

        function forceLogin() {
            // è®¾ç½®å®Œæ•´çš„ç™»å½•çŠ¶æ€ - ä½¿ç”¨æ­£ç¡®çš„key
            const mockToken = 'Bearer_mock_admin_token_' + Date.now();
            const mockUser = {
                user_id: 1,
                username: 'admin',
                user_type: 'admin',
                email: 'admin@example.com',
                roles: ['admin'],
                permissions: ['dashboard:view', 'users:manage', 'roles:manage', 'menus:manage', 'enterprise:manage']
            };

            // è®¾ç½®åˆ°localStorage - ä½¿ç”¨æ­£ç¡®çš„key
            localStorage.setItem('txgy_token', mockToken);  // æ­£ç¡®çš„token key
            localStorage.setItem('user_info', JSON.stringify(mockUser));

            // ä¹Ÿè®¾ç½®æ—§çš„keyä»¥å…¼å®¹
            localStorage.setItem('auth_token', mockToken);

            // ä¹Ÿè®¾ç½®åˆ°sessionStorageï¼ˆä»¥é˜²ä¸‡ä¸€ï¼‰
            sessionStorage.setItem('txgy_token', mockToken);
            sessionStorage.setItem('user_info', JSON.stringify(mockUser));
            
            updateStatus('login-status', 'âœ… ç™»å½•çŠ¶æ€å·²å¼ºåˆ¶è®¾ç½®', 'success');
            
            // æ˜¾ç¤ºè®¾ç½®çš„ä¿¡æ¯
            const loginInfo = document.getElementById('login-info');
            loginInfo.textContent = `ä»¤ç‰Œ: ${mockToken}\nç”¨æˆ·ä¿¡æ¯: ${JSON.stringify(mockUser, null, 2)}`;
            
            updateStatus('access-status', 'âœ… ç°åœ¨å¯ä»¥è®¿é—®ç®¡ç†åå°äº†ï¼Œè¯·ç‚¹å‡»ä¸Šé¢çš„é“¾æ¥', 'success');
            
            console.log('ğŸ”§ å¼ºåˆ¶ç™»å½•è®¾ç½®å®Œæˆ');
            console.log('ğŸ”§ ä»¤ç‰Œ:', mockToken);
            console.log('ğŸ”§ ç”¨æˆ·ä¿¡æ¯:', mockUser);
        }

        function clearLogin() {
            // æ¸…é™¤æ‰€æœ‰å¯èƒ½çš„token key
            localStorage.removeItem('txgy_token');  // æ­£ç¡®çš„token key
            localStorage.removeItem('auth_token');  // å…¼å®¹çš„token key
            localStorage.removeItem('user_info');
            sessionStorage.removeItem('txgy_token');
            sessionStorage.removeItem('auth_token');
            sessionStorage.removeItem('user_info');
            
            updateStatus('login-status', 'âŒ ç™»å½•çŠ¶æ€å·²æ¸…é™¤', 'error');
            document.getElementById('login-info').textContent = '';
            updateStatus('access-status', 'âš ï¸ éœ€è¦é‡æ–°è®¾ç½®ç™»å½•çŠ¶æ€', 'info');
            
            console.log('ğŸ”§ ç™»å½•çŠ¶æ€å·²æ¸…é™¤');
        }

        function copyDebugCode() {
            const code = `// æ£€æŸ¥Vueåº”ç”¨å®ä¾‹
console.log('Vueåº”ç”¨:', window.__VUE_DEVTOOLS_GLOBAL_HOOK__?.apps?.[0]);

// æ£€æŸ¥Pinia store
const app = window.__VUE_DEVTOOLS_GLOBAL_HOOK__?.apps?.[0];
if (app) {
  const pinia = app._instance?.appContext?.app?.config?.globalProperties?.$pinia;
  console.log('Piniaå®ä¾‹:', pinia);
  
  if (pinia) {
    const menuStore = pinia._s.get('menu');
    console.log('èœå•Store:', menuStore);
    console.log('allMenus:', menuStore?.allMenus);
    console.log('menuList:', menuStore?.menuList);
    
    // å¼ºåˆ¶é‡æ–°åŠ è½½èœå•
    if (menuStore) {
      menuStore.loadUserMenus().then(() => {
        console.log('èœå•é‡æ–°åŠ è½½å®Œæˆ');
        console.log('æ–°çš„menuList:', menuStore.menuList);
      });
    }
  }
}`;
            
            navigator.clipboard.writeText(code).then(() => {
                alert('è°ƒè¯•ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼è¯·åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­ç²˜è´´å¹¶è¿è¡Œã€‚');
            }).catch(() => {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ä¸Šé¢çš„ä»£ç ã€‚');
            });
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥å½“å‰ç™»å½•çŠ¶æ€
        window.onload = function() {
            const token = localStorage.getItem('txgy_token') || localStorage.getItem('auth_token');
            const userInfo = localStorage.getItem('user_info');
            
            if (token && userInfo) {
                updateStatus('login-status', 'âœ… æ£€æµ‹åˆ°ç°æœ‰ç™»å½•çŠ¶æ€', 'success');
                updateStatus('access-status', 'âœ… å¯ä»¥è®¿é—®ç®¡ç†åå°', 'success');
                
                const loginInfo = document.getElementById('login-info');
                loginInfo.textContent = `ä»¤ç‰Œ: ${token}\nç”¨æˆ·ä¿¡æ¯: ${userInfo}`;
            } else {
                updateStatus('login-status', 'âŒ æœªæ£€æµ‹åˆ°ç™»å½•çŠ¶æ€', 'error');
                updateStatus('access-status', 'âš ï¸ éœ€è¦è®¾ç½®ç™»å½•çŠ¶æ€', 'info');
            }
        };
    </script>
</body>
</html>
